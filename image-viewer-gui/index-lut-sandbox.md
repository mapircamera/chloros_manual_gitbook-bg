# Индекс/LUT Sandbox

Индекс/LUT Sandbox е интерактивно работно пространство в Chloros Image Viewer, което ви позволява да експериментирате с изчисления на мултиспектрални индекси и визуализации на цветове в реално време. Този мощен инструмент ви помага да тествате различни индекси, да усъвършенствате диапазоните на стойностите и да създавате визуализации, готови за публикуване, без да преобработвате целия си набор от данни.

## Какво е Index/LUT Sandbox?

### Цел

Sandbox предоставя:

* **Изчисляване на индекс в реално време** – Прилагане на всеки растителен индекс незабавно
* **Интерактивна настройка на LUT** – Фина настройка на цветовите градиенти и диапазони
* **Оптимизация на работния процес** – Определяне на най-добрите настройки преди пакетна обработка

### Sandbox срещу обработка на проекти

**Index/LUT Sandbox (интерактивен):**

* Едно изображение наведнъж
* Незабавна обратна връзка
* Експериментален и итеративен
* Без постоянни промени във файловете
* Идеален за проучване и тестване

**Обработка на проекти (пакетно):**

* Цял набор от данни наведнъж
* Предварително конфигурирани настройки
* Постоянни изходни файлове
* Отнема много време
* Най-доброто решение, когато настройките са финализирани

{% hint style=&quot;success&quot; %}
**Най-добър работен процес**: Използвайте Sandbox, за да експериментирате и да намерите оптимални настройки за индекса и LUT, след което приложете тези настройки по време на обработката на проекта за целия набор от данни.
{% endhint %}

***

## Работа с Index/LUT Sandbox

### Разбиране на предварително изчислените индекси

В Chloros индексите могат да се прилагат по време на обработката на проекта. За да определите кои настройки на индекса и LUT искате да приложите към експортираните файлове, най-лесно е да използвате Sandbox за преглед на изображения.

Sandbox ви позволява да:

* **Прилагате нови индекси и цветови градиенти (LUT)** за визуализиране на данните
* **Настройвате интерактивно настройките за визуализация*** **Преглеждате** вече изчислени индексни изображения
* **Проверявате** стойностите на пикселите на всички нива на мащабиране

### Отваряне на пясъчника

Достъпът до пясъчника Index/LUT се осъществява от **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> страничната лента:

1. Кликнете върху изображение в мрежата на файловия браузър, за да го отворите в **прозореца за преглед на изображения** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> .
2. Кликнете върху **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> , за да отворите лявата изскачаща странична лента, ако все още не е отворена

### Избор на изображение, към което да приложите индекс/LUT

За да работите с индекс в Image Viewer <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> :

1. **Отворете изображение** от основната мрежа с изображения, като кликнете върху него
2. Ще се отвори раздел **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> ще се отвори
3. Кликнете върху **падащото меню Layer** (в горния десен ъгъл на прозореца)
4. Изберете слоя от падащото меню:
   * RAW (Reflectance)

### Прилагане на индекс към изображение

След като изображението е на цял екран и страничната лента **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> е отворен:

1. Маркирайте полето „Индекс“ в горната част на страничната лента
2. Изберете филтъра на камерата си от падащото меню вляво
3. Изберете желаната формула за индекса от падащото меню вдясно
4. Плъзнете цветните кръгчета на филтърния канал до местата във формулата за индекса по-долу
5. Щом формулата е валидна, изображението ще се актуализира и ще покаже стойностите на индекса
6. Преместете курсора на мишката, за да видите стойностите в мястото, където се намира курсорът
7. Увеличете, за да видите отделните пиксели и свързаните с тях стойности.

Всеки индекс има специфичен диапазон на стойности и значение:

#### NDVI Пример

```

Formula: (NIR - Red) / (NIR + Red)

For Survey3W RGN camera:
NIR = 850nm band
Red = 661nm band

Result range: -1.0 to +1.0
Typical vegetation: 0.4 to 0.9
Stressed vegetation: 0.2 to 0.4
Bare soil: 0.0 to 0.2
Water: -0.1 to 0.1
```

За пълна документация на формулата на индекса вижте [Формули на мултиспектрални индекси](../project-settings/multispectral-index-formulas.md).

***

## Работа с LUT (таблици за търсене)

### Какво е LUT?

**Таблицата за търсене (LUT)** съпоставя числовите стойности на индекса с цветове за визуализация:

* **Вход**: Стойност на пиксела на индекса (напр. NDVI 0,65)
* **Изход**: RGB цвят (например яркозелено)
* **Цел**: Да направи моделите по-лесни за разглеждане и интерпретиране**LUT в сиво и LUT в цвят:**

* Сиво: Научно и неутрално, показва суровите данни
* LUT в цвят: Интуитивно и впечатляващо, подчертава моделите и разликите

{% hint style=&quot;success&quot; %}
**Визуализационна мощ**: Прилагането на цветен LUT към индексно изображение в сиво прави значително по-лесно разпознаването на модели, аномалии и области от интерес с един поглед.
{% endhint %}

### Прилагане на LUT към индексно изображение

След като имате индексно изображение, показващо

1. Кликнете върху <img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line"> бутона „+Добави LUT“
2. Изберете цветния градиент
3. Настройте минималната/максималната крайна точка на изрязване
4. Настройте режима на изрязване
5. Маркирайте полето „Индекс“ в страничната лента на **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> в страничната лента, за да приложите LUT.

### Избор на цветови градиент

**Избор на градиент:**

1. В панела LUT намерете**цветната лента с градиент**.
2. Насочете мишката върху нея, за да видите наличните предварителни настройки на градиента.
3. Изберете желания градиент.
4. Изображението **се актуализира незабавно** с новите цветове, когато кутията „Индекс“ е отбелязана.

{% hint style=&quot;success&quot; %}
**Най-добра практика**: За растителни индекси като NDVI, градиентът Red-Yellow-Green е най-интуитивен, защото съответства на естествените цветови асоциации (зелено = здраво, жълто = умерено, червено = стресирано).
{% endhint %}

### Настройка на цветовите класове

**Контролът на класовете**определя колко дискретни цветови стъпки се появяват в градиента:**Опции за брой класове:*** **2-5 класа**: Много широки категории, отчетливи зони
* **6-10 класа**: Балансирани, подходящи за класификация
* **11-20 класа**: Плавни градиенти, непрекъснат вид
* **20+ класа**: Почти непрекъснати, максимална плавност**Как да настроите:**

1. В панела LUT намерете**квадратчетата с цветови мостри под лентата с градиент**

2. Настройте броя на класовете, като добавите с бутона +
3. Премахнете броя на класовете, като кликнете два пъти върху цветен мостра
4. Преходът се актуализира **в реално време** върху изображението**Ефект върху визуализацията:*** **По-малко класове** (3-5): Създава отделни зони, опростена класификация, по-лесно разграничаване на категориите
* **Средно количество класове** (6-10): Балансиран подход, подходящ за повечето приложения
* **Повече класове** (15-20): Плавни преходи, подробни вариации, фотографски вид**Кога да се използва:*** **Малко класове (3-5)**: Презентационни слайдове, класификационни карти, прости отчети
* **Средно количество класове (6-10)**: Общ анализ, балансирани детайли, стандартни отчети
* **Много класове (15-20)**: Научен анализ, подробна инспекция, резултати с качество за публикуване

### Фина настройка на диапазоните на стойностите

**Контролите на диапазона на стойностите**определят кои индексни стойности се отнасят към кои цветове във вашия градиент:**Контроли на диапазона в панела LUT:*** **Минимална стойност**: Долна граница на цветовата скала
* **Максимална стойност**: Горна граница на цветовата скала
* **Междинни стойности**: Автоматично разпределени между минималната и максималната стойност (въз основа на броя на класовете)

#### Настройка на минимални/максимални стойности

**За да настроите диапазоните на стойностите:**

1. В панела LUT намерете полетата за въвеждане**Минимална стойност**и**Максимална стойност**

2. Кликнете върху полето**Минимална стойност**

3. Въведете желаната минимална стойност (например `0.2`).
4. Натиснете **Enter** или кликнете извън полето.
5. Повторете за полето **Макс. стойност** (например `0.9`).
6. Визуализацията **се актуализира незабавно**.

{% hint style=&quot;info&quot; %}
**Автоматично мащабиране**: Когато приложите LUT за първи път, Chloros автоматично задава минималната/максималната стойност на действителния диапазон от данни в изображението. След това можете да стесните този диапазон, за да се фокусирате върху конкретни диапазони от стойности, които ви интересуват.
{% endhint %}

**Пример за настройки на диапазона NDVI:*** **Пълен диапазон**: `-1.0` до `1.0` (показване на всички възможни стойности)
* **Фокусиран върху растителността**: `0.2` до `0.9` (изключване на голата почва и водата)
* **Само здрава растителност**: `0.5` до `0.9` (подчертаване само на жизнени растения)
* **Откриване на стрес**: `0.2` до `0.5` (подчертаване на проблемни области)
* **Персонализиран диапазон**: Настройка въз основа на наблюдаваните стойности на пикселите**Защо да настройвате диапазоните?*** **Увеличаване на контраста** в областта, която ви интересува
* **Изключване на нерелевантни стойности** (напр. водни басейни, гола почва)
* **Стандартизиране на визуализацията** в множество изображения или дати
* **Подчертаване на фини разлики** в тесен диапазон от стойности

### Изрязване на стойности извън диапазона

Когато стойностите на пикселите са извън дефинирания от вас минимален/максимален диапазон, можете да контролирате как се показват, като използвате **режими на изрязване**.

#### **Налични опции за режим на изрязване:**

#### 1. Минимална и максимална стойност

* Пиксели **под минималната стойност**→ показват се с**първия цвят** в градиента (например червен)
* Пиксели **над максималната стойност**→ показват се с**последния цвят** в градиента (например зелен)
* **Пример за употреба**: Подчертаване на крайности, показване на пълен диапазон от данни с наситени цветове в границите
* **Пример**: NDVI стойности под 0,2 се показват в червено, стойности над 0,9 се показват в зелено

#### 2. Прозрачен фон

* Пикселите **извън диапазона**стават**напълно прозрачни*** Само пикселите **в диапазона** показват цветови градиент
* **Пример за употреба**: GIS наслагване, изолиране на конкретни диапазони от стойности, подчертаване само на области от интерес
* **Пример**: Показване само на NDVI 0,4-0,7 в цвят, всичко останало е прозрачно

{% hint style=&quot;warning&quot; %}
**Ограничение на прозрачността**: Прозрачните пиксели ще се показват като цвят на фона в прозореца за преглед. При експортиране по време на обработката прозрачността се запазва във формат PNG, но не и в JPG.
{% endhint %}

#### 3. Фон на индекса

* Пикселите **извън обхвата**се показват в**сиво** (показват суровите стойности на индекса)
* Пикселите **в диапазона**показват**цветови градиент*** **Пример за употреба**: Деликатно подчертаване, запазване на контекста при акцентиране на областите от интерес
* **Пример**: Цветово подчертаване на стресирана растителност (NDVI 0,3-0,5), като здравите области се показват в сиво

#### 4. Оригинален фон

* Пикселите **извън обхвата**се показват като**оригинално мултиспектрално изображение*** Пикселите **в обхвата**се показват като**цветови градиент*** **Пример за употреба**: Най-интуитивен – комбинира естествения контекст на изображението с аналитично наслагване на цветове
* **Пример**: Вижте действителния вид на полето/културата с наслагване на цветово кодирани стресирани области

### Избор на подходящ режим на изрязване

| Режим на изрязване              | Най-подходящ за                                   | Стил на визуализация          |
| -------------------------- | ------------------------------------------ | ---------------------------- |
| **Минимално и максимално**    | Пълно показване на данни, научен анализ     | Всички пиксели са оцветени           |
| **Прозрачен фон** | Наслагвания на ГИС, изолиране на конкретни диапазони    | Цвят в диапазона, празно извън него |
| **Индексен фон**       | Дискретно подчертаване, запазване на контекста на данните  | Цвят в диапазона, сиво извън него  |
| **Оригинален фон**    | Отчети, презентации, интуитивен анализ | Цвят в диапазона, снимка извън него |

### Създаване на персонализирани LUT цветове

За пълен контрол върху визуализацията можете да създадете **персонализирани цветови градиенти**, като редактирате отделни цветови спирки.**За да създадете персонализиран градиент:**

1. В панела LUT намерете**лентата за преглед на градиента**.
2. Потърсете **квадратчетата с цветови мостри** под градиента.
3. **Кликнете върху цветова спирка**, за да я изберете.
4. Отваря се **палитра за избор на цвят**.
5. Изберете нов цвят, като използвате:
   * **Цветово колело**: Визуален избор на цвят.
   * **Плъзгачи RGB/HSV**: Прецизен контрол на цвета.
   * **Въвеждане на шестнадесетичен код**: Точна спецификация на цвета (например `#FF0000` за червено).
6. Кликнете извън селектора на цветове, **за да приложите новия цвят**.
7. Градиентът **се актуализира незабавно** върху изображението.**Добавяне или премахване на цветови спирки:*** **Добавяне на спирка**: Кликнете върху иконата +, за да добавите нова мостра в края.
* **Премахване на спирка**: Кликнете два пъти върху цветния квадрат, за да премахнете мострата.**Стратегии за персонализиране:*** **Обърнете градиента**: Обърнете реда на цветовете, за да обърнете значението (например зелено = ниско, червено = високо)
* **Цветове на марката**: Съвместете цветовата палитра на вашата организация за отчетите
* **Подходящ за хора с цветова слепота**: Използвайте комбинации от оранжево-синьо или лилаво-жълто
* **Оптимизация на печата**: Изберете цветове, които работят както при цветен, така и при печат в сиво
* **Многопрагов**: Използвайте различни цветове при определени прагове на стойности за класификация

{% hint style=&quot;info&quot; %}
**Запазване на персонализирани градиенти**: Персонализираните градиенти могат да се запазват и използват повторно. Кликнете върху иконата за запазване в панела LUT, за да запазите персонализираните цветови схеми за бъдеща употреба.
{% endhint %}

***

## Интерактивен работен процес

### Актуализации в реално време

Всички настройки на LUT в пясъчника актуализират изображението **незабавно и интерактивно**:

* **Превключване на слой** → Изображението се променя незабавно
* **Избор на градиент** → Цветовете се актуализират незабавно
* **Настройка на диапазона на стойностите** → Контрастът се променя в реално време
* **Промяна на класове** → Гладкостта на градиента се актуализира незабавно
* **Модифициране на изрязване** → Показването на фона се променя незабавно
* **Редактиране на цветовете** → Персонализираният градиент се прилага незабавно**Няма нужда от бутон „Приложи“** – всички промени са в реално време и интерактивни!

{% hint style=&quot;success&quot; %}
**Обратна връзка в реално време**: Незабавната визуална обратна връзка ви позволява бързо да експериментирате с различни настройки, докато намерите оптималната визуализация за вашите нужди от анализ.
{% endhint %}

### Итеративен работен процес за усъвършенстване

**Типичен работен процес за оптимизиране на LUT:**

1.**Изберете индекс слой** (например RAW (отражателност))
2. **Приложете индекс** - Изберете филтър на камерата и формула на индекса, плъзнете цветните кръгчета до подходящото място във формулата на индекса
3. **Приложете градиент на LUT** - Започнете с предварително зададената настройка Red-Yellow-Green
4. **Проверете стойностите на пикселите** - Преместете курсора, отбележете диапазоните на стойностите
5. **Настройте минималната/максималната стойност** - Стеснете, за да се фокусирате върху растителността (например от 0,2 до 0,9)
6. **Изберете изрязване** - Опитайте „Оригинален фон“ за контекст
7. **Усъвършенствайте цветовете** - Персонализирайте градиента, ако е необходимо, за специфично подчертаване
8. **Финализирайте настройките**- Документирайте настройките и копирайте в Настройки на проекта за обработка на експорта

### Проверка на стойността на пикселите

Разбирането на действителните стойности на пикселите е от решаващо значение за задаването на ефективни LUT диапазони:**Как да проверите стойностите:**

1. Стойностите на пикселите се показват, когато изображението има**отбелязани** кутийките „Индекс“ или „Индекс и LUT“.
2. **Преместете курсора** върху различни области на изображението
3. **Наблюдавайте стойностите на пикселите**, показвани в легендата, докато премествате курсора
4. Увеличете, за да видите отделните пиксели, подчертани с плаваща стойност
5. **Запишете** диапазоните на стойностите за различните характеристики:
   * **Здрава растителност**: например NDVI 0,55-0,85
   * **Растителност под стрес**: например NDVI 0,30-0,50
   * **Гола почва**: например, NDVI 0,05-0,25
   * **Вода** (ако има): например, NDVI -0,05 до 0,10**Използване на пикселни стойности за настройка на LUT диапазони:**След като проверите пикселните стойности, настройте съответно минималната/максималната стойност на LUT:**Примерна ситуация:*** **Наблюдение**: Стойности на почвата = 0,05-0,25, Стресирана = 0,25-0,50, Здрава = 0,50-0,85
* **Цел**: Визуализиране само на здравето на растенията (изключване на почвата)
* **Настройки на LUT**: Мин. = `0.25`, Макс. = `0.85`
* **Изрязване**: „Оригинален фон“, за да се види почвата в естествения й цвят
* **Резултат**: Цветовият градиент се прилага само за растителността, почвата се показва като оригинално изображение

{% hint style=&quot;info&quot; %}
**Динамичен диапазон**: Различните култури, сезони и етапи на растеж ще имат различни диапазони на стойности. Винаги проверявайте стойностите на пикселите в конкретния си набор от данни, преди да зададете диапазоните на LUT.
{% endhint %}

***

## Персонализирани индекси (Chloros+)

### Създаване на формули за персонализирани индекси

{% hint style=&quot;info&quot; %}
**Къде да създадете**: Персонализираните индекси могат да бъдат конфигурирани в**Настройки на проекта** преди обработката, както и в страничната лента на Image Viewer sandbox.
{% endhint %}

**За да създадете персонализиран индекс:**

1.**Отворете Настройки на проекта** (преди обработката) или страничната лента на Image Viewer sandbox.
2. Преминете към **падащото меню Формула на индекса**.
3. Потърсете опцията **„Персонализирано“** (трябва да сте влезли с лиценз Chloros+).
4. **Дефинирайте формулата си**, използвайки променливи на лентата:
   * Имена на лентите: `NIR`, `Red`, `Green`, `Blue`, `RedEdge` и т.н.
   * Оператори: `+`, `-`, `*`, `/`, `^` (експонента)
   * Функции: `sqrt()`, `abs()` и др. (ако се поддържат)
   * Скоби: `()` за ред на операциите
5. **Име на индекса** (напр. „MyIndex“ или „CustomNDVI“)
6. **Запазете конфигурацията**

**Примери за персонализирани формули:**

```

Modified NDVI with offset:
(NIR - Red) / (NIR + Red + 0.5)

Simple ratio:
NIR / Red

Complex multi-band:
(NIR - Red) / (NIR + Red - Blue)

Exponential index:
(NIR / Red) ^ 2
```

{% hint style=&quot;warning&quot; %}
**Валидиране на формулата**: Уверете се, че формулата ви използва ленти, които са налични във вашата камера. Например, RedEdge е наличен само на камери с филтър RedEdge.
{% endhint %}

***

## Следващи стъпки

Сега, след като разбрахте Index/LUT Sandbox:

* **Приложете към обработката**: Използвайте откритите настройки в [Настройки на проекта](../project-settings/project-settings.md)
* **Батова обработка**: Приложете оптимизираните индекси към пълните набори от данни
* **Научете повече**: Прочетете [Формули за мултиспектрални индекси](../project-settings/multispectral-index-formulas.md)

Свързана документация:

* [**Слоеве на изображения**](image-layers.md) - Управление и визуализация на слоеве
* [**Отваряне на изображение на цял екран**](opening-an-image-full-screen.md) – Основни принципи на работа с Image Viewer
* [**Обработка на изображения (GUI)**](../processing-images-gui/adding-files-to-a-project.md) – Пълен работен процес на обработка
